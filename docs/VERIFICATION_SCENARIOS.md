# EasyPay 기능 확인 시나리오

**작성일**: 2026-02-10
**대상**: 프론트엔드(localhost:3001) + 백엔드(localhost:8080) 통합 확인

---

## 사전 준비

```bash
# 1. 백엔드 인프라 + 앱 기동
cd backend && docker-compose up -d

# 2. 프론트엔드 개발 서버
cd frontend && pnpm dev
```

- 백엔드: http://localhost:8080
- 프론트엔드: http://localhost:3001
- Swagger UI: http://localhost:8080/swagger-ui

---

## 시나리오 1: 회원가입 → 로그인

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | `/signup` 접속 | 회원가입 폼 표시 |
| 2 | 이메일: `alice@test.com`, 이름: `Alice`, 비밀번호: `password123`, PIN: `123456` 입력 후 가입 | 성공 → 로그인 페이지로 이동 |
| 3 | 같은 이메일로 로그인 | 성공 → `/dashboard` 이동 |
| 4 | 두 번째 계정 생성 — `bob@test.com` / `Bob` / `password123` / `654321` | 가입 성공 |

**확인 포인트**:
- 중복 이메일 가입 시 에러 메시지 표시
- 비밀번호 8자 미만 / PIN 6자리 아닌 경우 유효성 검사 작동
- 로그인 후 헤더에 사용자 이름 표시

---

## 시나리오 2: 계좌 생성 → 충전

> Alice 계정으로 진행

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | 사이드바 `계좌 관리` 클릭 | `/accounts` 페이지 |
| 2 | `새 계좌 만들기` 버튼 클릭 → 일일 한도 설정 후 생성 | 계좌 카드 표시 (잔액 0원) |
| 3 | 생성된 계좌 카드 클릭 | `/accounts/{id}` 상세 페이지 |
| 4 | `충전` 버튼 → 1,000,000원 입력 → 충전 | 잔액 1,000,000원으로 변경 |
| 5 | 거래 내역에 `CREDIT` (입금) 1건 표시 확인 | 금액, 잔액 정확 |

**확인 포인트**:
- 계좌번호 자동 생성 (`EASYPAY-XXX-XXX` 형식)
- 충전 후 잔액 즉시 반영
- 거래 내역에 입금 기록 존재

---

## 시나리오 3: 송금

> 사전 조건: Alice 계좌(잔액 1,000,000원), Bob도 로그인하여 계좌 1개 생성

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | Alice 로그인 → 사이드바 `송금` 클릭 | `/transfer` 페이지 |
| 2 | 출금 계좌: Alice 계좌 선택 | 잔액 표시 |
| 3 | 수신 계좌 ID: Bob의 계좌 ID 입력, 금액: 100,000원, 메모: `점심값` | - |
| 4 | `송금하기` 클릭 → PIN 모달 표시 → `123456` 입력 | 송금 성공 화면 |
| 5 | 송금 결과 화면에서 상태 `COMPLETED` 확인 | 송금 코드(TRF-...) 표시 |
| 6 | `/accounts` → Alice 계좌 잔액 확인 | 900,000원 |
| 7 | Bob 로그인 → 계좌 잔액 확인 | 100,000원 |

**확인 포인트**:
- PIN 틀렸을 때 에러 메시지
- 잔액 부족 시 송금 실패 에러
- 양쪽 계좌 거래 내역에 각각 DEBIT/CREDIT 기록

---

## 시나리오 4: 실시간 알림 (SSE)

> 브라우저 2개 필요 (또는 시크릿 모드)

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | 브라우저 A: Alice 로그인, 브라우저 B: Bob 로그인 | 양쪽 대시보드 |
| 2 | 브라우저 A에서 Alice → Bob 송금 실행 | 송금 완료 |
| 3 | 브라우저 A 확인 | 토스트 알림: "송금이 완료되었습니다" |
| 4 | 브라우저 B 확인 | 토스트 알림: "입금이 되었습니다" |

**확인 포인트**:
- 로그인 즉시 SSE 연결 (`connect` 이벤트)
- 송금 완료 시 송신자/수신자 모두 알림 수신
- 토스트가 우측 상단에 표시되고 자동 소멸

---

## 시나리오 5: 송금 취소

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | Alice → Bob 송금 실행 (50,000원) | 성공, 결과 화면 이동 |
| 2 | 송금 상태 페이지에서 `취소` 버튼 클릭 | 상태 `CANCELLED`로 변경 |
| 3 | Alice 계좌 잔액 확인 | 50,000원 복구 확인 |
| 4 | Bob 계좌 잔액 확인 | 변동 없음 |

**확인 포인트**:
- 완료 후 30분 이내만 취소 가능
- 취소 후 양쪽 계좌 잔액 원복

---

## 시나리오 6: 결제 → 환불

> 사전 조건: 결제용 가맹점 ID 필요 (Swagger에서 `POST /api/v1/merchants`로 등록하거나, 프론트에서 merchantId를 직접 입력)

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | Alice 로그인 → 사이드바 `결제` 클릭 | `/payment` 페이지 |
| 2 | 결제 계좌 선택, 가맹점 ID 입력, 금액: 30,000원 | - |
| 3 | `결제하기` → PIN 입력 | 결제 성공, 상태 `COMPLETED` |
| 4 | Alice 계좌 잔액 30,000원 차감 확인 | - |
| 5 | 결제 상태 페이지에서 `환불` 버튼 클릭 | 상태 `REFUNDED`로 변경 |
| 6 | Alice 계좌 잔액 복구 확인 | 30,000원 환불 |

**확인 포인트**:
- 결제 완료 시 실시간 알림 (SSE)
- 환불 후 잔액 정확히 복구
- 거래 내역에 결제/환불 각각 기록

---

## 시나리오 7: 거래 내역 조회

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | 사이드바 `거래 내역` 클릭 | `/transactions` 페이지 |
| 2 | 계좌 선택 드롭다운에서 Alice 계좌 선택 | 전체 거래 목록 표시 |
| 3 | 스크롤 다운 | 무한 스크롤로 추가 데이터 로드 (20건 단위) |
| 4 | 거래 유형 필터 `DEBIT` 선택 | 출금 내역만 표시 |

**확인 포인트**:
- 충전, 송금, 결제 등 모든 거래가 시간순 정렬
- 커서 기반 페이지네이션 정상 동작
- 유형 필터링 정확

---

## 시나리오 8: 대시보드

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | 로그인 후 `/dashboard` 확인 | 계좌 잔액 카드, 최근 거래 5건, 빠른 액션 버튼 |
| 2 | `송금하기` 버튼 클릭 | `/transfer`로 이동 |
| 3 | `결제하기` 버튼 클릭 | `/payment`로 이동 |
| 4 | `계좌 관리` 버튼 클릭 | `/accounts`로 이동 |

**확인 포인트**:
- 계좌가 없으면 계좌 생성 안내
- 최근 거래 5건이 정확한 데이터

---

## 시나리오 9: 정산 조회 (가맹점)

> Swagger(`POST /api/v1/merchants`)에서 가맹점을 먼저 등록하고, 결제 수건 발생 후 정산 배치를 실행해야 데이터 확인 가능

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | 사이드바 `정산` 클릭 | `/settlement` 페이지 |
| 2 | 정산 내역 확인 | 가맹점별 정산 리스트 + 추이 차트 |
| 3 | 개별 정산 항목 확인 | 총액, 수수료(3%), 순정산액, 거래 건수 |

---

## 시나리오 10: 관리자 페이지

| 단계 | 동작 | 기대 결과 |
|:---:|------|----------|
| 1 | 사이드바 `관리자` 클릭 | `/admin` 페이지 |
| 2 | 시스템 개요 확인 | 전체 계좌 수, 활성 계좌, 총 잔액, 대기 정산 |
| 3 | `수동 정산 실행` 버튼 클릭 | "정산 배치 실행 시작" 메시지 |

---

## 에러 케이스 확인

| 케이스 | 동작 | 기대 결과 |
|--------|------|----------|
| 잔액 부족 송금 | 잔액보다 큰 금액 송금 | 에러 토스트: "잔액이 부족합니다" |
| PIN 오류 | 송금 시 틀린 PIN 입력 | 에러 토스트: "PIN이 일치하지 않습니다" |
| 자기 자신 송금 | 같은 계좌끼리 송금 | 에러 처리 |
| 미인증 접근 | 로그아웃 후 `/dashboard` 접근 | `/login`으로 리다이렉트 |
| 토큰 만료 | Access Token 만료 상태에서 API 호출 | 자동 갱신 후 재시도 (사용자 무감지) |

---

## 권장 확인 순서

```
시나리오 1 (회원가입/로그인)
  → 시나리오 2 (계좌 생성/충전)
    → 시나리오 8 (대시보드)
      → 시나리오 3 (송금)
        → 시나리오 4 (실시간 알림)
          → 시나리오 5 (송금 취소)
            → 시나리오 6 (결제/환불)
              → 시나리오 7 (거래 내역)
                → 에러 케이스
```

시나리오 9(정산), 10(관리자)은 가맹점 등록 + 결제 데이터가 축적된 후 확인.
